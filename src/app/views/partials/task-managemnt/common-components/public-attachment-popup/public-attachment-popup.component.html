<!-- Public Attachments Modal -->
<div
  class="tw-fixed tw-inset-0 tw-bg-black tw-bg-opacity-50 tw-flex tw-items-center tw-justify-center tw-z-50 tw-p-4 md:tw-p-6"
  (click)="closePopup()"
>
  <!-- Modal Container - Fixed size on desktop, full screen on mobile -->
  <div
    class="tw-bg-white tw-rounded-none md:tw-rounded-2xl tw-shadow-2xl tw-w-full tw-h-full md:tw-w-[700px] md:tw-h-[700px] tw-flex tw-flex-col tw-overflow-hidden tw-animate-scale-in"
    (click)="$event.stopPropagation()"
  >
    <!-- Header -->
    <div
      class="tw-flex tw-items-center tw-justify-between tw-p-4 md:tw-p-6 tw-border-b tw-border-gray-200 tw-bg-gray-50"
    >
      <div class="tw-flex tw-items-center tw-space-x-3">
        <div
          class="tw-w-8 tw-h-8 tw-bg-blue-500 tw-rounded-lg tw-flex tw-items-center tw-justify-center"
        >
          <i class="fas fa-paperclip tw-text-white tw-text-sm"></i>
        </div>
        <div>
          <span class="tw-text-lg tw-font-semibold tw-text-gray-900">Board Attachments</span>
          <div class="tw-text-sm tw-text-gray-500">
            {{ attachments.length }} attachment{{ attachments.length !== 1 ? 's' : '' }}
          </div>
        </div>
      </div>

      <button
        type="button"
        class="tw-p-2 tw-text-gray-400 hover:tw-text-gray-600 hover:tw-bg-gray-200 tw-rounded-lg tw-transition-all tw-duration-200"
        (click)="closePopup()"
      >
        <i class="fas fa-times tw-text-lg"></i>
      </button>
    </div>

    <!-- Loading State -->
    <div
      *ngIf="isLoading"
      class="tw-flex tw-items-center tw-justify-center tw-h-full tw-w-full"
    >
      <div
        class="tw-w-8 tw-h-8 tw-border-4 tw-border-blue-500 tw-border-t-transparent tw-rounded-full tw-animate-spin"
      ></div>
    </div>

    <!-- Attachments Content -->
    <div *ngIf="!isLoading" class="tw-flex-1 tw-flex tw-flex-col tw-overflow-hidden">
      <!-- Attachments List -->
      <div class="tw-flex-1 tw-overflow-y-auto tw-p-4 md:tw-p-6">
        <div class="tw-space-y-4 tw-mb-6">
          <!-- No Attachments State -->
          <div
            *ngIf="attachments.length === 0"
            class="tw-text-center tw-py-12"
          >
            <div
              class="tw-w-16 tw-h-16 tw-bg-gray-100 tw-rounded-full tw-flex tw-items-center tw-justify-center tw-mx-auto tw-mb-4"
            >
              <i class="fas fa-paperclip tw-text-gray-400 tw-text-xl"></i>
            </div>
            <h3 class="tw-text-lg tw-font-medium tw-text-gray-900 tw-mb-2">
              No attachments
            </h3>
            <p class="tw-text-gray-500">
              Upload files to get started.
            </p>
          </div>

          <!-- Attachment Items -->
          <div
            *ngFor="
              let attachment of attachments;
              trackBy: trackByAttachmentId
            "
            class="tw-space-y-4"
          >
            <div
              *ngFor="let file of attachment.files"
              class="tw-group tw-bg-white tw-border tw-border-gray-200 tw-rounded-lg tw-p-4 hover:tw-shadow-md tw-transition-all tw-duration-200"
            >
              <div class="tw-flex tw-items-center tw-justify-between">
                <div
                  class="tw-flex tw-items-center tw-space-x-3 tw-flex-1 tw-min-w-0"
                >
                  <!-- File Icon -->
                  <div
                    class="tw-w-10 tw-h-10 tw-bg-blue-50 tw-rounded-lg tw-flex tw-items-center tw-justify-center tw-flex-shrink-0"
                  >
                    <i
                      [class]="
                        'fas ' +
                        getFileIcon(file.fileType) +
                        ' tw-text-blue-600'
                      "
                    ></i>
                  </div>

                  <!-- File Info -->
                  <div class="tw-flex-1 tw-min-w-0">
                    <h4
                      class="tw-text-sm tw-font-medium tw-text-gray-900 tw-truncate"
                    >
                      {{ file.fileName }}
                    </h4>
                    <div
                      class="tw-flex tw-items-center tw-space-x-2 tw-text-xs tw-text-gray-500 tw-mt-1"
                    >
                      <span>{{ attachment.uploadedBy._id === taskPermissionsService.getCurrentUser()._id ? 'You' : attachment.uploadedBy.name }}</span>
                      <span>â€¢</span>
                      <span>{{ formatDate(attachment.createdAt) }}</span>
                      <span
                        *ngIf="file.uploadedFrom === 'url'"
                        class="tw-bg-green-100 tw-text-green-800 tw-px-2 tw-py-0.5 tw-rounded-full"
                      >
                        Link
                      </span>
                    </div>
                  </div>
                </div>

                <!-- Actions -->
                <div
                  class="tw-flex tw-items-center tw-space-x-2 tw-opacity-0 group-hover:tw-opacity-100 tw-transition-opacity tw-duration-200"
                >
                  <a
                    [href]="imageBaseUrl + file.fileUrl"
                    target="_blank"
                    class="tw-p-2 tw-text-gray-400 hover:tw-text-blue-600 hover:tw-bg-blue-50 tw-rounded-lg tw-transition-all tw-duration-200"
                  >
                    <i class="fas fa-external-link-alt tw-text-sm"></i>
                  </a>

                  <button
                    *ngIf="isAttachmentAccessible(attachment)"
                    type="button"
                    (click)="deleteAttachment(file._id, attachment._id)"
                    class="tw-p-2 tw-text-gray-400 hover:tw-text-red-600 hover:tw-bg-red-50 tw-rounded-lg tw-transition-all tw-duration-200"
                  >
                    <i class="fas fa-trash tw-text-sm"></i>
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Upload Options -->
      <div
        class="tw-border-t tw-border-gray-200 tw-p-4 md:tw-p-6 tw-bg-gray-50"
        [ngClass]="{ 'tw-cursor-not-allowed': !attachmentPermissions }"
      >
        <div
          class="tw-grid tw-grid-cols-1 tw-gap-4"
          [ngClass]="{
            'tw-pointer-events-none tw-opacity-50 ': !attachmentPermissions
          }"
        >
          <!-- File Upload -->
          <div class="tw-relative">
            <input
              type="file"
              [disabled]="!attachmentPermissions"
              #fileInput
              (change)="onFileUpload($event)"
              multiple
              class="tw-absolute tw-inset-0 tw-w-full tw-h-full tw-opacity-0 tw-cursor-pointer"
            />

            <div
              class="tw-border-2 tw-border-dashed tw-border-gray-300 tw-rounded-lg tw-px-6 tw-py-4 tw-flex tw-gap-3 tw-justify-center hover:tw-border-blue-400 hover:tw-bg-blue-100 tw-transition-all tw-duration-200 tw-cursor-pointer"
            >
              <i
                class="fas fa-cloud-upload-alt tw-text-blue-600 tw-text-xl"
              ></i>
              <span class="tw-text-sm tw-font-medium tw-text-gray-900">
                Upload Files to Board
              </span>
            </div>
            <div class="tw-text-xs tw-text-gray-500 tw-mt-2 tw-text-center">
  Maximum file size: 10MB
</div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Mobile-specific styles -->
<style>
  @media (max-width: 768px) {
    .tw-animate-scale-in {
      animation: none;
    }
  }

  .tw-animate-scale-in {
    animation: scaleIn 0.2s ease-out;
  }

  @keyframes scaleIn {
    from {
      opacity: 0;
      transform: scale(0.95);
    }
    to {
      opacity: 1;
      transform: scale(1);
    }
  }
</style>