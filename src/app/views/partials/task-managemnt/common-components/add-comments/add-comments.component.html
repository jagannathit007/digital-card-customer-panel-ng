<!-- Chat Container -->
<div class="tw-bg-white tw-rounded-lg tw-shadow-lg tw-border tw-border-gray-200 tw-max-w-2xl tw-mx-auto tw-p-6">
  
  <!-- Header -->
  <div class="tw-flex tw-items-center tw-justify-between tw-mb-4 tw-pb-3 tw-border-b tw-border-gray-100">
    <h3 class="tw-text-lg tw-font-semibold tw-text-gray-800">Add Comment</h3>
    <div class="tw-flex tw-items-center tw-space-x-2">
      <span class="tw-text-sm tw-text-gray-500">{{ selectedUsers.length }} mentioned</span>
    </div>
  </div>

  <!-- Chat Input Container -->
  <div class="tw-relative">
    
    <!-- Main Input Area -->
    <div class="tw-relative tw-border tw-border-gray-300 tw-rounded-lg tw-focus-within:ring-2 tw-focus-within:ring-blue-500 tw-focus-within:border-blue-500 tw-transition-all tw-duration-200">
      
      <!-- Content Editable Input -->
      <div #chatInput
           contenteditable="true"
           (input)="onInputChange($event)"
           (keydown)="onKeyDown($event)"
           class="tw-w-full tw-min-h-[80px] tw-max-h-[200px] tw-p-3 tw-text-sm tw-text-gray-700 tw-bg-transparent tw-outline-none tw-overflow-y-auto tw-resize-none tw-leading-relaxed"
           placeholder="Type @ to mention someone..."
           [attr.data-placeholder]="inputText.length === 0 ? 'Type @ to mention someone...' : null">
      </div>
      
      <!-- Placeholder styling when empty -->
      <style>
        [contenteditable]:empty:before {
          content: attr(data-placeholder);
          color: #9CA3AF;
          pointer-events: none;
        }
        [contenteditable] {
          white-space: pre-wrap;
          word-wrap: break-word;
        }
      </style>
      
      <!-- Send Button -->
      <div class="tw-absolute tw-bottom-2 tw-right-2">
        <button (click)="sendMessage()"
                [disabled]="!inputText.trim()"
                class="tw-bg-blue-500 hover:tw-bg-blue-600 disabled:tw-bg-gray-300 disabled:tw-cursor-not-allowed tw-text-white tw-p-2 tw-rounded-lg tw-transition-colors tw-duration-200 tw-shadow-sm">
          <svg class="tw-w-4 tw-h-4" fill="currentColor" viewBox="0 0 20 20">
            <path d="M10.894 2.553a1 1 0 00-1.788 0l-7 14a1 1 0 001.169 1.409l5-1.429A1 1 0 009 15.571V11a1 1 0 112 0v4.571a1 1 0 00.725.962l5 1.428a1 1 0 001.17-1.408l-7-14z"></path>
          </svg>
        </button>
      </div>
    </div>

    <!-- Mention Dropdown -->
    <div *ngIf="showDropdown" 
         class="tw-absolute tw-z-50 tw-w-full tw-bg-white tw-border tw-border-gray-200 tw-rounded-lg tw-shadow-lg tw-max-h-64 tw-overflow-hidden"
         [style.top.px]="dropdownPosition.top"
         [style.left.px]="dropdownPosition.left"
         [style.min-width.px]="300">
      
      <!-- Dropdown Header -->
      <div class="tw-px-3 tw-py-2 tw-border-b tw-border-gray-100 tw-bg-gray-50">
        <div class="tw-flex tw-items-center tw-justify-between">
          <span class="tw-text-xs tw-font-medium tw-text-gray-500 tw-uppercase tw-tracking-wide">
            Select Member
          </span>
          <span class="tw-text-xs tw-text-gray-400">
            {{ filteredUsers.length }} found
          </span>
        </div>
      </div>
      
      <!-- Users List -->
      <div class="tw-max-h-48 tw-overflow-y-auto"
           (scroll)="onDropdownScroll($event)">
        
        <!-- User Items -->
        <div *ngFor="let user of filteredUsers; trackBy: trackByUserId"
             (click)="selectUser(user)"
             class="tw-flex tw-items-center tw-px-3 tw-py-3 tw-cursor-pointer hover:tw-bg-blue-50 tw-transition-colors tw-duration-150 tw-border-b tw-border-gray-50 last:tw-border-b-0">
          
          <!-- Profile Image -->
          <div class="tw-flex-shrink-0 tw-mr-3">
            <img [src]="getProfileImageUrl(user.profileImage)" 
                 [alt]="user.name"
                 class="tw-w-8 tw-h-8 tw-rounded-full tw-border tw-border-gray-200 tw-object-cover">
          </div>
          
          <!-- User Info -->
          <div class="tw-flex-1 tw-min-w-0">
            <div class="tw-flex tw-items-center tw-justify-between">
              <p class="tw-text-sm tw-font-medium tw-text-gray-900 tw-truncate">
                {{ user.name }}
              </p>
              <span class="tw-text-xs tw-text-gray-500 tw-bg-gray-100 tw-px-2 tw-py-1 tw-rounded-full tw-ml-2 tw-flex-shrink-0">
                {{ user.role }}
              </span>
            </div>
          </div>
          
          <!-- Selected Indicator -->
          <div *ngIf="mentionedMembers.includes(user.id)" 
               class="tw-flex-shrink-0 tw-ml-2">
            <svg class="tw-w-4 tw-h-4 tw-text-blue-500" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
            </svg>
          </div>
        </div>
        
        <!-- Loading Indicator -->
        <div *ngIf="isLoading" 
             class="tw-flex tw-items-center tw-justify-center tw-py-4">
          <div class="tw-animate-spin tw-rounded-full tw-h-6 tw-w-6 tw-border-b-2 tw-border-blue-500"></div>
          <span class="tw-ml-2 tw-text-sm tw-text-gray-500">Loading more...</span>
        </div>
        
        <!-- No Results -->
        <div *ngIf="!isLoading && filteredUsers.length === 0" 
             class="tw-px-3 tw-py-8 tw-text-center">
          <svg class="tw-mx-auto tw-h-8 tw-w-8 tw-text-gray-300" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
          </svg>
          <p class="tw-mt-2 tw-text-sm tw-text-gray-500">
            No members found matching "{{ currentMentionQuery }}"
          </p>
        </div>
      </div>
    </div>
  </div>

  <!-- Character Count -->
  <div class="tw-mt-2 tw-text-right">
    <span class="tw-text-xs tw-text-gray-400">
      {{ inputText.length }} characters
    </span>
  </div>
</div>