<!-- Modal Overlay -->
<div *ngIf="isVisible" class="tw-fixed tw-inset-0 tw-bg-black tw-bg-opacity-50 tw-flex tw-items-center tw-justify-center tw-z-50 tw-p-4 tw-animate-fade-in">
  <!-- Modal Container -->
  <div class="tw-bg-white tw-rounded-lg tw-shadow-xl tw-w-full tw-max-w-md tw-max-h-[90vh] tw-overflow-hidden tw-transform tw-transition-all tw-duration-300 tw-scale-100 tw-animate-slide-up">
    
    <!-- Modal Header -->
    <div class="tw-bg-white tw-border-b tw-border-gray-200 tw-px-6 tw-py-4">
      <div class="tw-flex tw-items-center tw-justify-between">
        <div class="tw-flex tw-items-center tw-space-x-3">
          <div class="tw-w-10 tw-h-10 tw-bg-blue-500 tw-rounded-full tw-flex tw-items-center tw-justify-center tw-shadow-sm">
            <i class="fas fa-user-edit tw-text-white tw-text-lg"></i>
          </div>
          <div>
            <h3 class="tw-text-lg tw-font-semibold tw-text-gray-900">Change Member Role</h3>
            <p class="tw-text-gray-600 tw-text-sm">Update user permissions</p>
          </div>
        </div>
        <button 
          (click)="closeModal()" 
          class="tw-text-gray-400 tw-hover:tw-text-gray-600 tw-hover:tw-bg-gray-100 tw-rounded-full tw-p-2 tw-transition-all tw-duration-200"
          [disabled]="isLoading">
          <i class="fas fa-times tw-text-lg"></i>
        </button>
      </div>
    </div>

    <!-- Modal Body -->
    <div class="tw-p-6">
      
      <!-- User Info Card -->
      <div class="tw-bg-gray-50 tw-rounded-lg tw-p-4 tw-mb-6 tw-border tw-border-gray-100">
        <div class="tw-flex tw-items-center tw-space-x-4">
          <div class="tw-relative">
            <img 
              [src]="baseURL + selectedMember.profileImage" 
              [alt]="selectedMember.name"
              class="tw-w-12 tw-h-12 tw-rounded-full tw-object-cover tw-border-2 tw-border-white tw-shadow-sm">
            <div class="tw-absolute -tw-bottom-1 -tw-right-1 tw-w-4 tw-h-4 tw-bg-green-500 tw-rounded-full tw-border-2 tw-border-white tw-animate-pulse" 
                 *ngIf="selectedMember.isActive"></div>
          </div>
          <div class="tw-flex-1">
            <h4 class="tw-font-semibold tw-text-gray-900">{{ selectedMember.name }}</h4>
            <p class="tw-text-sm tw-text-gray-600">{{ selectedMember.emailId }}</p>
            <div class="tw-flex tw-items-center tw-mt-2">
              <span class="tw-text-xs tw-px-3 tw-py-1 tw-rounded-full tw-bg-blue-100 tw-text-blue-700 tw-font-medium tw-border tw-border-blue-200"
                    [class]="getRoleBadgeClass(selectedMember.role)">
                <i [class]="getRoleIcon(selectedMember.role)" class="tw-mr-1"></i>
                {{ selectedMember.role | titlecase }}
              </span>
            </div>
          </div>
        </div>
      </div>

      <!-- Permission Check -->
      <div *ngIf="!canChangeRole" class="tw-bg-red-50 tw-border tw-border-red-200 tw-rounded-lg tw-p-4 tw-mb-6">
        <div class="tw-flex tw-items-center tw-space-x-3">
          <i class="fas fa-exclamation-triangle tw-text-red-500 tw-text-lg"></i>
          <div>
            <span class="tw-text-red-700 tw-font-semibold">Permission Denied</span>
            <p class="tw-text-sm tw-text-red-600 tw-mt-1">
              You don't have permission to change this user's role. Only users with higher privileges can modify roles.
            </p>
          </div>
        </div>
      </div>

      <!-- Role Selection -->
      <div *ngIf="canChangeRole" class="tw-space-y-4">
        <div>
          <label class="tw-block tw-text-sm tw-font-semibold tw-text-gray-700 tw-mb-3">
            Select New Role
          </label>
          
          <!-- Role Options -->
          <div class="tw-space-y-3">
            <div *ngFor="let option of roleOptions" 
                 class="tw-relative tw-group">
              <label class="tw-flex tw-items-center tw-p-4 tw-border tw-rounded-lg tw-cursor-pointer tw-transition-all tw-duration-200 tw-hover:tw-shadow-sm"
                     [class.tw-border-blue-300]="selectedRole === option.value && !option.disabled"
                     [class.tw-bg-blue-50]="selectedRole === option.value && !option.disabled"
                     [class.tw-border-gray-200]="selectedRole !== option.value && !option.disabled"
                     [class.tw-hover:tw-border-gray-300]="selectedRole !== option.value && !option.disabled"
                     [class.tw-bg-gray-50]="option.disabled"
                     [class.tw-cursor-not-allowed]="option.disabled"
                     [class.tw-opacity-60]="option.disabled">
                
                <div class="tw-flex tw-items-center tw-space-x-4 tw-flex-1">
                  <div class="tw-relative">
                    <input 
                      type="radio" 
                      [value]="option.value"
                      [(ngModel)]="selectedRole"
                      (change)="onRoleChange(option.value)"
                      [disabled]="option.disabled || isLoading"
                      class="tw-w-4 tw-h-4 tw-text-blue-600 tw-border-gray-300 tw-focus:tw-ring-blue-500 tw-focus:tw-ring-2">
                  </div>
                  
                  <div class="tw-flex tw-items-center tw-space-x-3">
                    <div class="tw-w-8 tw-h-8 tw-bg-gray-100 tw-rounded-full tw-flex tw-items-center tw-justify-center"
                         [class.tw-bg-blue-100]="selectedRole === option.value && !option.disabled">
                      <i [class]="getRoleIcon(option.value)" 
                         class="tw-text-gray-600"
                         [class.tw-text-blue-600]="selectedRole === option.value && !option.disabled"></i>
                    </div>
                    <div>
                      <span class="tw-text-sm tw-font-medium tw-text-gray-900"
                            [class.tw-text-gray-500]="option.disabled">
                        {{ option.label }}
                      </span>
                      <span *ngIf="option.disabled" class="tw-text-xs tw-text-gray-500 tw-ml-2">
                        (Restricted)
                      </span>
                    </div>
                  </div>
                </div>
                
                <!-- Current Role Indicator -->
                <span *ngIf="selectedMember.role === option.value" 
                      class="tw-text-xs tw-px-2 tw-py-1 tw-bg-green-100 tw-text-green-700 tw-rounded-full tw-border tw-border-green-200 tw-font-medium">
                  <i class="fas fa-check tw-mr-1"></i>Current
                </span>
              </label>
            </div>
          </div>
        </div>

        <!-- Error Message -->
        <div *ngIf="error" class="tw-bg-red-50 tw-border tw-border-red-200 tw-rounded-lg tw-p-4 tw-animate-shake">
          <div class="tw-flex tw-items-center tw-space-x-3">
            <i class="fas fa-exclamation-circle tw-text-red-500"></i>
            <span class="tw-text-sm tw-text-red-700 tw-font-medium">{{ error }}</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal Footer -->
    <div class="tw-bg-gray-50 tw-px-6 tw-py-4 tw-flex tw-justify-end tw-space-x-3 tw-border-t tw-border-gray-200">
      <button 
        (click)="closeModal()"
        [disabled]="isLoading"
        class="tw-px-4 tw-py-2 tw-text-sm tw-font-medium tw-text-gray-700 tw-bg-white tw-border tw-border-gray-300 tw-rounded-lg tw-hover:tw-bg-gray-50 tw-hover:tw-border-gray-400 tw-focus:tw-outline-none tw-focus:tw-ring-2 tw-focus:tw-ring-offset-2 tw-focus:tw-ring-gray-500 tw-transition-all tw-duration-200 tw-disabled:tw-opacity-50 tw-disabled:tw-cursor-not-allowed">
        <i class="fas fa-times tw-mr-2"></i>Cancel
      </button>
      
      <button 
        *ngIf="canChangeRole"
        (click)="changeRole()"
        [disabled]="isLoading || !selectedRole || selectedRole === selectedMember.role"
        class="tw-px-4 tw-py-2 tw-text-sm tw-font-medium tw-text-white tw-border tw-border-transparent tw-rounded-lg tw-focus:tw-outline-none tw-focus:tw-ring-2 tw-focus:tw-ring-offset-2 tw-focus:tw-ring-blue-500 tw-transition-all tw-duration-200 tw-disabled:tw-opacity-50 tw-disabled:tw-cursor-not-allowed tw-flex tw-items-center tw-space-x-2 {{isLoading || !selectedRole || selectedRole === selectedMember.role ? 'tw-cursor-not-allowed tw-bg-blue-400' : 'tw-bg-blue-600 tw-hover:tw-bg-blue-700'}}">
        <!-- Loading Spinner -->
        <i *ngIf="isLoading" class="fas fa-spinner tw-animate-spin"></i>
        <i *ngIf="!isLoading" class="fas fa-save"></i>
        
        <span>{{ isLoading ? 'Changing...' : 'Change Role' }}</span>
      </button>
    </div>
  </div>
</div>