<!-- Change Member Role Modal -->
<div
  *ngIf="isVisible"
  class="tw-fixed tw-inset-0 tw-bg-black tw-bg-opacity-50 tw-flex tw-items-center tw-justify-center tw-z-50 tw-p-4"
  (click)="onBackdropClick($event)"
>
  <div
    class="tw-bg-white tw-rounded-2xl tw-shadow-2xl tw-max-w-2xl tw-w-full tw-max-h-[90vh] tw-overflow-hidden tw-transform tw-transition-all tw-duration-300"
    (click)="$event.stopPropagation()"
  >
    <!-- Modal Header -->
    <div
      class="tw-flex tw-justify-between tw-items-center tw-p-6 tw-border-b tw-border-gray-200 tw-bg-gradient-to-r tw-from-blue-50 tw-to-indigo-50"
    >
      <div class="tw-flex tw-items-center tw-gap-4">
        <div class="tw-bg-blue-100 tw-p-3 tw-rounded-full">
          <i class="fas fa-sitemap tw-text-blue-600 tw-text-xl"></i>
        </div>
        <div>
          <h2 class="tw-text-2xl tw-font-bold tw-text-gray-900">
            Change Member Role
          </h2>
          <p class="tw-text-gray-600 tw-text-sm tw-mt-1">
            Update permissions and responsibilities
          </p>
        </div>
      </div>
      <button
        class="tw-text-gray-400 hover:tw-text-gray-600 tw-text-2xl tw-p-2 tw-rounded-full hover:tw-bg-gray-100 tw-transition-colors"
        (click)="onClose()"
      >
        <i class="fas fa-times"></i>
      </button>
    </div>

    <!-- Modal Content -->
    <div class="tw-p-6 tw-max-h-[70vh] tw-overflow-y-auto">
      <!-- Member Info Section -->
      <div class="tw-bg-gray-50 tw-rounded-xl tw-p-4 tw-mb-6">
        <div class="tw-flex tw-items-center tw-gap-4">
          <img
            [src]="baseURL + '/' + member.profileImage"
            [alt]="member?.name"
            class="tw-w-12 tw-h-12 tw-rounded-full tw-object-cover tw-border-2 tw-border-white tw-shadow-sm"
          />
          <div class="tw-flex-1">
            <h3 class="tw-font-semibold tw-text-gray-900 tw-text-lg">
              {{ member?.name }}
            </h3>
            <p class="tw-text-gray-600 tw-text-sm">{{ member?.emailId }}</p>
          </div>
          <div class="tw-text-right">
            <p class="tw-text-xs tw-text-gray-500 tw-mb-1">Current Role</p>
            <div class="tw-flex tw-items-center tw-gap-2">
              <i
                [class]="currentRoleInfo?.icon + ' ' + currentRoleInfo?.color"
              ></i>
              <span class="tw-font-medium tw-text-gray-900">{{
                currentRoleInfo?.label
              }}</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Role Selection Form -->
      <form (ngSubmit)="onSubmit()" class="tw-space-y-6">
        <!-- Role Selection -->
        <div
          *ngFor="let role of availableRoles"
          class="tw-relative tw-cursor-pointer tw-group"
          [class.tw-opacity-50]="
            role.value === member?.role ||
            isRoleHigherOrEqual(role.value, currentMemberDetails?.role)
          "
        >
          <input
            type="radio"
            [id]="'role-' + role.value"
            [value]="role.value"
            [(ngModel)]="selectedRole"
            name="memberRole"
            [disabled]="
              role.value === member?.role ||
              isRoleHigherOrEqual(role.value, currentMemberDetails?.role)
            "
            class="tw-sr-only"
          />
          <label
            [for]="'role-' + role.value"
            class="tw-flex tw-items-center tw-p-4 tw-border-2 tw-rounded-xl tw-transition-all tw-duration-200"
            [class]="getRadioLabelClasses(role)"
          >
            <div class="tw-flex tw-items-center tw-gap-4 tw-flex-1">
              <div
                class="tw-flex tw-items-center tw-justify-center tw-w-12 tw-h-12 tw-rounded-full tw-bg-white tw-shadow-sm"
              >
                <i [class]="role.icon + ' ' + role.color + ' tw-text-lg'"></i>
              </div>
              <div class="tw-flex-1">
                <div class="tw-flex tw-items-center tw-gap-2 tw-flex-wrap">
                  <h4 class="tw-font-semibold tw-text-gray-900">
                    {{ role.label }}
                  </h4>
                  <span
                    *ngIf="role.value === member?.role"
                    class="tw-bg-gray-100 tw-text-gray-600 tw-px-2 tw-py-1 tw-rounded-full tw-text-xs tw-font-medium"
                  >
                    Current
                  </span>
                  <span
                    *ngIf="
                      isRoleHigherOrEqual(
                        role.value,
                        currentMemberDetails?.role
                      ) && role.value !== member?.role
                    "
                    class="tw-bg-red-100 tw-text-red-600 tw-px-2 tw-py-1 tw-rounded-full tw-text-xs tw-font-medium"
                  >
                    Restricted
                  </span>
                </div>
                <p class="tw-text-gray-600 tw-text-sm tw-mt-1">
                  {{ role.description }}
                </p>
                <p
                  *ngIf="
                    isRoleHigherOrEqual(
                      role.value,
                      currentMemberDetails?.role
                    ) && role.value !== member?.role
                  "
                  class="tw-text-red-500 tw-text-xs tw-mt-1 tw-font-medium"
                >
                  You cannot assign roles equal to or higher than your own
                </p>
              </div>
            </div>
            <div
              class="tw-flex tw-items-center tw-justify-center tw-w-6 tw-h-6"
            >
              <div
                class="tw-w-4 tw-h-4 tw-rounded-full tw-border-2 tw-transition-all"
                [class]="
                  selectedRole === role.value
                    ? 'tw-border-blue-500 tw-bg-blue-500'
                    : 'tw-border-gray-300'
                "
              >
                <div
                  *ngIf="selectedRole === role.value"
                  class="tw-w-2 tw-h-2 tw-bg-white tw-rounded-full tw-mx-auto tw-mt-0.5"
                ></div>
              </div>
            </div>
          </label>
        </div>

        <!-- Change Summary -->
        <div
          *ngIf="selectedRole && selectedRole !== member?.role"
          class="tw-bg-blue-50 tw-border tw-border-blue-200 tw-rounded-xl tw-p-4"
        >
          <h4
            class="tw-font-semibold tw-text-blue-900 tw-mb-2 tw-flex tw-items-center tw-gap-2"
          >
            <i class="fas fa-info-circle"></i>
            Role Change Summary
          </h4>
          <div class="tw-flex tw-items-center tw-gap-4 tw-text-sm">
            <div class="tw-flex tw-items-center tw-gap-2">
              <i
                [class]="currentRoleInfo?.icon + ' ' + currentRoleInfo?.color"
              ></i>
              <span class="tw-text-gray-700">{{ currentRoleInfo?.label }}</span>
            </div>
            <i class="fas fa-arrow-right tw-text-blue-600"></i>
            <div class="tw-flex tw-items-center tw-gap-2">
              <i
                [class]="selectedRoleInfo?.icon + ' ' + selectedRoleInfo?.color"
              ></i>
              <span class="tw-font-medium tw-text-blue-900">{{
                selectedRoleInfo?.label
              }}</span>
            </div>
          </div>
        </div>

        <!-- Change Reason -->
        <!-- <div>
          <label for="changeReason" class="tw-block tw-text-sm tw-font-semibold tw-text-gray-700 tw-mb-2">
            Reason for Change <span class="tw-text-gray-400">(Optional)</span>
          </label>
          <textarea
            id="changeReason"
            [(ngModel)]="changeReason"
            name="changeReason"
            rows="3"
            class="tw-w-full tw-px-4 tw-py-3 tw-border tw-border-gray-200 tw-rounded-lg tw-resize-none focus:tw-ring-2 focus:tw-ring-blue-500 focus:tw-border-transparent tw-transition-all"
            placeholder="Provide a brief explanation for this role change..."
          ></textarea>
        </div> -->
      </form>
    </div>

    <!-- Modal Footer -->
    <div
      class="tw-flex tw-justify-end tw-gap-3 tw-p-6 tw-border-t tw-border-gray-200 tw-bg-gray-50"
    >
      <button
        type="button"
        class="tw-px-6 tw-py-2.5 tw-border tw-border-gray-300 tw-text-gray-700 tw-bg-white tw-rounded-lg tw-font-medium hover:tw-bg-gray-50 tw-transition-colors"
        (click)="onClose()"
        [disabled]="isLoading"
      >
        Cancel
      </button>
      <button
        type="submit"
        class="tw-px-6 tw-py-2.5 tw-bg-blue-600 tw-text-white tw-rounded-lg tw-font-medium hover:tw-bg-blue-700 tw-transition-colors tw-flex tw-items-center tw-gap-2 tw-disabled:opacity-50 tw-disabled:cursor-not-allowed"
        [disabled]="!isFormValid || isLoading"
        (click)="onSubmit()"
      >
        <i *ngIf="isLoading" class="fas fa-spinner tw-animate-spin"></i>
        <i *ngIf="!isLoading" class="fas fa-check"></i>
        {{ isLoading ? "Updating..." : "Update Role" }}
      </button>
    </div>
  </div>
</div>
