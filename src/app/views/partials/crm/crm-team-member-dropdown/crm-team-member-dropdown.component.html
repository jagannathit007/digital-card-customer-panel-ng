<div class="tw-relative">
  <!-- Trigger Button -->
  <button
    type="button"
    (click)="toggleDropdown()"
    class="tw-flex tw-items-center tw-space-x-2 tw-px-3 tw-py-2 tw-bg-white tw-border tw-border-gray-300 tw-rounded-lg tw-text-sm tw-font-medium tw-text-gray-700 hover:tw-bg-gray-50 focus:tw-outline-none focus:tw-ring-2 focus:tw-ring-blue-500 focus:tw-border-blue-500 tw-transition-all tw-duration-200"
    [class.tw-bg-blue-50]="isDropdownOpen"
    [class.tw-border-blue-300]="isDropdownOpen"
  >
    <i class="fas fa-users tw-text-gray-400"></i>
    <span>{{ selectedMembers.length > 0 ? selectedMembers.length + ' selected' : 'Select members' }}</span>
    <i 
      class="fas fa-chevron-down tw-text-gray-400 tw-transition-transform tw-duration-200"
      [class.tw-rotate-180]="isDropdownOpen"
    ></i>
  </button>

  <!-- Dropdown Menu -->
  <div
    *ngIf="isDropdownOpen"
    class="tw-absolute tw-z-50 tw-mt-2 tw-w-80 tw-bg-white tw-border tw-border-gray-200 tw-rounded-lg tw-shadow-lg tw-overflow-hidden"
    [@fadeInOut]
    [class.tw-left-0]="allignment === 'left'"
    [class.tw-right-0]="allignment === 'right'"
    [class.tw-top-full]="placement === 'bottom'"
    [class.tw-bottom-full]="placement === 'top'"
  >
    <!-- Header -->
    <div class="tw-p-4 tw-border-b tw-border-gray-200">
      <div class="tw-flex tw-items-center tw-justify-between tw-mb-3">
        <h3 class="tw-text-lg tw-font-semibold tw-text-gray-900">Team Members</h3>
        <button
          type="button"
          (click)="toggleDropdown()"
          class="tw-p-1 tw-text-gray-400 hover:tw-text-gray-600 hover:tw-bg-gray-100 tw-rounded tw-transition-colors"
        >
          <i class="fas fa-times tw-text-sm"></i>
        </button>
      </div>

      <!-- Search Input -->
      <div class="tw-relative">
        <input
          type="text"
          [value]="searchQuery"
          (input)="onSearchInput($event)"
          placeholder="Search members..."
          class="tw-w-full tw-pl-10 tw-pr-4 tw-py-2 tw-border tw-border-gray-300 tw-rounded-lg tw-text-sm focus:tw-ring-2 focus:tw-ring-blue-500 focus:tw-border-blue-500"
        />
        <i class="fas fa-search tw-absolute tw-left-3 tw-top-1/2 tw-transform tw--translate-y-1/2 tw-text-gray-400 tw-text-sm"></i>
        <button
          *ngIf="searchQuery"
          type="button"
          (click)="clearSearch()"
          class="tw-absolute tw-right-3 tw-top-1/2 tw-transform tw--translate-y-1/2 tw-text-gray-400 hover:tw-text-gray-600"
        >
          <i class="fas fa-times tw-text-sm"></i>
        </button>
      </div>
    </div>

    <!-- Loading State -->
    <div *ngIf="isLoading()" class="tw-p-4 tw-text-center">
      <div class="tw-animate-spin tw-rounded-full tw-h-6 tw-w-6 tw-border-b-2 tw-border-blue-600 tw-mx-auto"></div>
      <p class="tw-text-sm tw-text-gray-500 tw-mt-2">Loading members...</p>
    </div>

    <!-- Members List -->
    <div *ngIf="!isLoading()" class="tw-max-h-64 tw-overflow-y-auto">
      <!-- No Members State -->
      <div *ngIf="getFilteredMembers().length === 0" class="tw-p-4 tw-text-center">
        <div class="tw-w-12 tw-h-12 tw-bg-gray-100 tw-rounded-full tw-flex tw-items-center tw-justify-center tw-mx-auto tw-mb-3">
          <i class="fas fa-users tw-text-gray-400 tw-text-lg"></i>
        </div>
        <p class="tw-text-sm tw-text-gray-500">
          {{ searchQuery ? 'No members found matching your search' : 'No team members available' }}
        </p>
      </div>

      <!-- Members -->
      <div
        *ngFor="let member of getFilteredMembers()"
        (click)="onMemberSelect(member)"
        class="tw-flex tw-items-center tw-space-x-3 tw-p-3 hover:tw-bg-gray-50 tw-cursor-pointer tw-transition-colors tw-duration-150"
        [class.tw-bg-blue-50]="isMemberSelected(member)"
        (mouseenter)="onMemberHover(member, $event)"
        (mouseleave)="onMemberLeave()"
      >
        <!-- Selection Checkbox -->
        <div class="tw-flex-shrink-0">
          <div
            class="tw-w-5 tw-h-5 tw-border-2 tw-rounded tw-flex tw-items-center tw-justify-center tw-transition-colors tw-duration-150"
            [class.tw-border-blue-500]="isMemberSelected(member)"
            [class.tw-border-gray-300]="!isMemberSelected(member)"
            [class.tw-bg-blue-500]="isMemberSelected(member)"
          >
            <i
              *ngIf="isMemberSelected(member)"
              class="fas fa-check tw-text-white tw-text-xs"
            ></i>
          </div>
        </div>

        <!-- Profile Image/Initials -->
        <div class="tw-flex-shrink-0 tw-relative">
          <div
            *ngIf="!member.profileImage"
            class="tw-w-10 tw-h-10 tw-bg-blue-500 tw-rounded-full tw-flex tw-items-center tw-justify-center tw-text-white tw-font-semibold tw-text-sm"
            (mouseenter)="onProfileHover(member, $event)"
            (mouseleave)="onProfileLeave()"
          >
            {{ getInitials(member.name) }}
          </div>
          <img
            *ngIf="member.profileImage"
            [src]="imageBaseUrl + member.profileImage"
            [alt]="member.name"
            class="tw-w-10 tw-h-10 tw-rounded-full tw-object-cover"
            (mouseenter)="onProfileHover(member, $event)"
            (mouseleave)="onProfileLeave()"
          />
        </div>

        <!-- Member Info -->
        <div class="tw-flex-1 tw-min-w-0">
          <p class="tw-text-sm tw-font-medium tw-text-gray-900 tw-truncate">{{ member.name }}</p>
          <p class="tw-text-xs tw-text-gray-500 tw-truncate">{{ member.emailId }}</p>
          <p class="tw-text-xs tw-text-gray-400 tw-truncate">{{ member.role }}</p>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <div *ngIf="selectedMembers.length > 0" class="tw-p-4 tw-border-t tw-border-gray-200 tw-bg-gray-50">
      <div class="tw-flex tw-items-center tw-justify-between">
        <span class="tw-text-sm tw-text-gray-600">
          {{ selectedMembers.length }} member{{ selectedMembers.length !== 1 ? 's' : '' }} selected
        </span>
        <button
          type="button"
          (click)="selectedMembers = []; selectedMembersChange.emit([]); onMemberAdded.emit([])"
          class="tw-text-sm tw-text-red-600 hover:tw-text-red-800 hover:tw-bg-red-50 tw-px-2 tw-py-1 tw-rounded tw-transition-colors"
        >
          Clear all
        </button>
      </div>
    </div>
  </div>

  <!-- Tooltip -->
  <div
    *ngIf="showTooltip && hoveredMember"
    class="tw-fixed tw-z-50 tw-bg-gray-900 tw-text-white tw-text-xs tw-px-2 tw-py-1 tw-rounded tw-pointer-events-none"
    [style.top.px]="tooltipPosition.top"
    [style.left.px]="tooltipPosition.left"
    [@fadeInOut]
  >
    {{ hoveredMember.name }}
    <div class="tw-absolute tw-top-full tw-left-1/2 tw-transform tw--translate-x-1/2 tw-w-0 tw-h-0 tw-border-l-4 tw-border-r-4 tw-border-t-4 tw-border-transparent tw-border-t-gray-900"></div>
  </div>

  <!-- Profile Tooltip -->
  <div
    *ngIf="showProfileTooltip && hoveredMember"
    class="tw-fixed tw-z-50 tw-bg-white tw-border tw-border-gray-200 tw-rounded-lg tw-shadow-lg tw-p-3 tw-pointer-events-none tw-w-48"
    [style.top.px]="profileTooltipPosition.top"
    [style.left.px]="profileTooltipPosition.left"
    [@fadeInOut]
  >
    <div class="tw-flex tw-items-center tw-space-x-3 tw-mb-2">
      <div
        *ngIf="!hoveredMember.profileImage"
        class="tw-w-12 tw-h-12 tw-bg-blue-500 tw-rounded-full tw-flex tw-items-center tw-justify-center tw-text-white tw-font-semibold"
      >
        {{ getInitials(hoveredMember.name) }}
      </div>
      <img
        *ngIf="hoveredMember.profileImage"
        [src]="imageBaseUrl + hoveredMember.profileImage"
        [alt]="hoveredMember.name"
        class="tw-w-12 tw-h-12 tw-rounded-full tw-object-cover"
      />
    </div>
    <h4 class="tw-font-semibold tw-text-gray-900 tw-text-sm">{{ hoveredMember.name }}</h4>
    <p class="tw-text-gray-600 tw-text-xs">{{ hoveredMember.emailId }}</p>
    <p class="tw-text-gray-500 tw-text-xs">{{ hoveredMember.role }}</p>
    <div class="tw-absolute tw-top-full tw-left-1/2 tw-transform tw--translate-x-1/2 tw-w-0 tw-h-0 tw-border-l-4 tw-border-r-4 tw-border-t-4 tw-border-transparent tw-border-t-white"></div>
  </div>
</div>

    <!-- Click outside to close -->
<div *ngIf="isDropdownOpen" class="tw-fixed tw-inset-0 tw-z-0 ng-star-inserted" (click)="toggleDropdown()"></div>
