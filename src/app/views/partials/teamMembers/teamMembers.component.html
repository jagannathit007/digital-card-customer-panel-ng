<div class="tw-relative tw-flex tw-items-center">
  <!-- Display first two members -->
  <div class="tw-flex tw--space-x-2">
    <div 
      *ngFor="let member of displayMembers(); let i = index"
      class="tw-relative tw-group"
      (mouseenter)="onMemberHover(member, $event)"
      (mouseleave)="onMemberLeave()"
    >
      <!-- Member Avatar -->
      <div class="tw-relative tw-w-8 tw-h-8 tw-rounded-full tw-overflow-hidden tw-border-2 tw-border-white tw-shadow-sm tw-cursor-pointer tw-transition-all tw-duration-200 hover:tw-scale-110 hover:tw-z-10">
        <img 
          *ngIf="member.profileImage; else initialsTemplate"
          [src]="member.profileImage"
          [alt]="member.name"
          class="tw-w-full tw-h-full tw-object-cover"
          [style.z-index]="10 - i"
        >
        <ng-template #initialsTemplate>
          <div class="tw-w-full tw-h-full tw-bg-gradient-to-br tw-from-blue-500 tw-to-purple-600 tw-flex tw-items-center tw-justify-center tw-text-white tw-text-xs tw-font-semibold">
            {{ getMemberInitials(member.name) }}
          </div>
        </ng-template>
      </div>

      <!-- Member Tooltip -->
      <div 
        *ngIf="hoveredMember()?._id === member._id && showTooltip()"
        class="tw-absolute tw-bottom-full tw-left-1/2 tw-transform tw--translate-x-1/2 tw-mb-2 tw-z-50 tw-animate-fade-in"
      >
        <div class="tw-bg-white tw-rounded-lg tw-shadow-lg tw-border tw-border-gray-200 tw-p-3 tw-min-w-[200px]">
          <!-- Member Info Card -->
          <div class="tw-flex tw-items-center tw-mb-3">
            <div class="tw-w-10 tw-h-10 tw-rounded-full tw-overflow-hidden tw-border-2 tw-border-gray-100 tw-mr-3">
              <img 
                *ngIf="member.profileImage; else tooltipInitialsTemplate"
                [src]="member.profileImage"
                [alt]="member.name"
                class="tw-w-full tw-h-full tw-object-cover"
              >
              <ng-template #tooltipInitialsTemplate>
                <div class="tw-w-full tw-h-full tw-bg-gradient-to-br tw-from-blue-500 tw-to-purple-600 tw-flex tw-items-center tw-justify-center tw-text-white tw-text-sm tw-font-semibold">
                  {{ getMemberInitials(member.name) }}
                </div>
              </ng-template>
            </div>
            <div class="tw-flex-1">
              <h4 class="tw-font-semibold tw-text-gray-900 tw-text-sm">{{ member.name }}</h4>
              <p class="tw-text-xs tw-text-gray-500 tw-capitalize">{{ member.role }}</p>
            </div>
          </div>
          
          <div class="tw-space-y-1">
            <div class="tw-flex tw-items-center tw-text-xs tw-text-gray-600">
              <svg class="tw-w-3 tw-h-3 tw-mr-2 tw-text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 4.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
              </svg>
              <span class="tw-truncate">{{ member.emailId }}</span>
            </div>
            
            <div class="tw-flex tw-items-center tw-text-xs tw-text-gray-600">
              <svg class="tw-w-3 tw-h-3 tw-mr-2 tw-text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
              </svg>
              <span class="tw-capitalize">{{ member.role }}</span>
            </div>
          </div>
          
          <!-- Tooltip Arrow -->
          <div class="tw-absolute tw-top-full tw-left-1/2 tw-transform tw--translate-x-1/2 tw-w-0 tw-h-0 tw-border-l-4 tw-border-r-4 tw-border-t-4 tw-border-transparent tw-border-t-white"></div>
          <div class="tw-absolute tw-top-full tw-left-1/2 tw-transform tw--translate-x-1/2 tw-w-0 tw-h-0 tw-border-l-4 tw-border-r-4 tw-border-t-4 tw-border-transparent tw-border-t-gray-200 tw-mt-px"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Remaining members count -->
  <div 
    *ngIf="remainingCount() > 0"
    class="tw-relative tw-ml-1"
    (mouseenter)="onCountHover($event)"
    (mouseleave)="onCountLeave()"
    (click)="onShowMembers($event)"
  >
    <div class="tw-w-8 tw-h-8 tw-rounded-full tw-bg-gray-100 tw-border-2 tw-border-white tw-shadow-sm tw-flex tw-items-center tw-justify-center tw-cursor-pointer tw-transition-all tw-duration-200 hover:tw-bg-blue-100 hover:tw-scale-110 hover:tw-shadow-md">
      <span class="tw-text-xs tw-font-semibold tw-text-gray-600">+{{ remainingCount() }}</span>
    </div>

    <!-- Count Tooltip -->
    <div 
      *ngIf="showTooltip() && !hoveredMember()"
      class="tw-absolute tw-bottom-full tw-left-1/2 tw-transform tw--translate-x-1/2 tw-mb-2 tw-z-50 tw-animate-fade-in"
    >
      <div class="tw-bg-gray-900 tw-text-white tw-text-xs tw-rounded-lg tw-px-3 tw-py-2 tw-whitespace-nowrap tw-shadow-lg">
        {{ remainingCount() }} more member{{ remainingCount() > 1 ? 's' : '' }}
        <div class="tw-absolute tw-top-full tw-left-1/2 tw-transform tw--translate-x-1/2 tw-w-0 tw-h-0 tw-border-l-4 tw-border-r-4 tw-border-t-4 tw-border-transparent tw-border-t-gray-900"></div>
      </div>
    </div>
  </div>

  <!-- Show empty state if no members -->
  <div 
    *ngIf="totalMembers() === 0"
    class="tw-flex tw-items-center tw-text-gray-400"
  >
    <div class="tw-w-8 tw-h-8 tw-rounded-full tw-bg-gray-100 tw-border-2 tw-border-gray-200 tw-border-dashed tw-flex tw-items-center tw-justify-center">
      <svg class="tw-w-4 tw-h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
      </svg>
    </div>
    <span class="tw-text-xs tw-text-gray-500 tw-ml-2">No members</span>
  </div>
</div>

<!-- Members Modal -->
<div 
  *ngIf="showMembersModal()"
  class="tw-fixed tw-inset-0 tw-bg-black tw-bg-opacity-50 tw-flex tw-items-center tw-justify-center tw-z-50 tw-animate-fade-in"
  (click)="onCloseModal()"
>
  <div 
    class="tw-bg-white tw-rounded-2xl tw-p-6 tw-w-full tw-max-w-lg tw-mx-4 tw-max-h-[80vh] tw-overflow-y-auto tw-animate-scale-in"
    (click)="$event.stopPropagation()"
  >
    <div class="tw-flex tw-justify-between tw-items-center tw-mb-6">
      <h3 class="tw-text-xl tw-font-bold tw-text-gray-900">Board Members</h3>
      <button 
        (click)="onCloseModal()"
        class="tw-text-gray-400 hover:tw-text-gray-600 tw-transition-colors tw-duration-200"
      >
        <svg class="tw-w-6 tw-h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
        </svg>
      </button>
    </div>

    <!-- Members List -->
    <div class="tw-space-y-3 tw-mb-6">
      <div 
        *ngFor="let member of members" 
        class="tw-flex tw-items-center tw-justify-between tw-p-4 tw-bg-gray-50 tw-rounded-lg tw-hover:bg-gray-100 tw-transition-colors tw-duration-200"
      >
        <!-- Member Avatar -->
        <div class="tw-flex tw-items-center">
          <div class="tw-w-12 tw-h-12 tw-rounded-full tw-overflow-hidden tw-border-2 tw-border-white tw-shadow-sm tw-mr-4">
            <img 
              *ngIf="member.profileImage; else memberInitialsTemplate"
              [src]="member.profileImage"
              [alt]="member.name"
              class="tw-w-full tw-h-full tw-object-cover"
            >
            <ng-template #memberInitialsTemplate>
              <div class="tw-w-full tw-h-full tw-bg-gradient-to-br tw-from-blue-500 tw-to-purple-600 tw-flex tw-items-center tw-justify-center tw-text-white tw-text-sm tw-font-semibold">
                {{ getMemberInitials(member.name) }}
              </div>
            </ng-template>
          </div>

          <!-- Member Info -->
          <div>
            <h4 class="tw-font-semibold tw-text-gray-900 tw-text-sm">{{ member.name }}</h4>
            <p class="tw-text-xs tw-text-gray-500">{{ member.emailId }}</p>
            <select 
              [(ngModel)]="member.role"
              (ngModelChange)="onRoleChange(member._id, $event)"
              class="tw-mt-1 tw-px-2 tw-py-1 tw-border tw-border-gray-200 tw-rounded-lg tw-text-xs tw-bg-white tw-focus:outline-none tw-focus:ring-2 tw-focus:ring-blue-500"
            >
              <option value="leader">Leader</option>
              <option value="developer">Developer</option>
              <option value="manager">Manager</option>
              <option value="editor">Editor</option>
              <option value="designer">Designer</option>
            </select>
          </div>
        </div>

        <!-- Remove Button -->
        <button 
          (click)="onRemoveMember(member._id); $event.stopPropagation()"
          class="tw-text-red-500 hover:tw-text-red-700 tw-transition-colors tw-duration-200"
        >
          <svg class="tw-w-4 tw-h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
          </svg>
        </button>
      </div>
    </div>

    <!-- Add Member Button -->
    <div class="tw-flex tw-gap-3">
      <button 
        (click)="onCloseModal()"
        class="tw-flex-1 tw-px-4 tw-py-2 tw-border tw-border-gray-200 tw-text-gray-700 tw-rounded-lg tw-font-medium hover:tw-bg-gray-50 tw-transition-colors tw-duration-200"
      >
        Close
      </button>
      <button 
        (click)="onShowAddMember($event)"
        class="tw-flex-1 tw-bg-blue-600 tw-text-white tw-px-4 tw-py-2 tw-rounded-lg tw-font-medium hover:tw-bg-blue-700 tw-transition-colors tw-duration-200"
      >
        Add Member
      </button>
    </div>
  </div>
</div>

<!-- Add Member Modal -->
<div 
  *ngIf="showAddMemberModal()"
  class="tw-fixed tw-inset-0 tw-bg-black tw-bg-opacity-50 tw-flex tw-items-center tw-justify-center tw-z-50 tw-animate-fade-in"
  (click)="onCloseModal()"
>
  <div 
    class="tw-bg-white tw-rounded-2xl tw-p-6 tw-w-full tw-max-w-lg tw-mx-4 tw-max-h-[80vh] tw-overflow-y-auto tw-animate-scale-in"
    (click)="$event.stopPropagation()"
  >
    <div class="tw-flex tw-justify-between tw-items-center tw-mb-6">
      <h3 class="tw-text-xl tw-font-bold tw-text-gray-900">Add Team Members</h3>
      <button 
        (click)="onCloseModal()"
        class="tw-text-gray-400 hover:tw-text-gray-600 tw-transition-colors tw-duration-200"
      >
        <svg class="tw-w-6 tw-h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
        </svg>
      </button>
    </div>

    <!-- Available Team Members -->
    <div class="tw-space-y-3 tw-mb-6">
      <div 
        *ngFor="let member of availableTeamMembers" 
        class="tw-flex tw-items-center tw-justify-between tw-p-4 tw-bg-gray-50 tw-rounded-lg tw-hover:bg-gray-100 tw-transition-colors tw-duration-200"
      >
        <div class="tw-flex tw-items-center">
          <!-- Member Avatar -->
          <div class="tw-w-10 tw-h-10 tw-rounded-full tw-overflow-hidden tw-border-2 tw-border-white tw-shadow-sm tw-mr-3">
            <img 
              *ngIf="member.profileImage; else teamMemberInitialsTemplate"
              [src]="member.profileImage"
              [alt]="member.name"
              class="tw-w-full tw-h-full tw-object-cover"
            >
            <ng-template #teamMemberInitialsTemplate>
              <div class="tw-w-full tw-h-full tw-bg-gradient-to-br tw-from-green-500 tw-to-blue-600 tw-flex tw-items-center tw-justify-center tw-text-white tw-text-xs tw-font-semibold">
                {{ getMemberInitials(member.name) }}
              </div>
            </ng-template>
          </div>

          <!-- Member Info -->
          <div>
            <h4 class="tw-font-medium tw-text-gray-900 tw-text-sm">{{ member.name }}</h4>
            <p class="tw-text-xs tw-text-gray-500">{{ member.emailId }}</p>
            <div class="tw-flex tw-items-center tw-gap-2 tw-mt-1">
              <span class="tw-inline-flex tw-items-center tw-px-2 tw-py-0.5 tw-rounded-full tw-text-xs tw-font-medium tw-bg-green-100 tw-text-green-800 tw-capitalize">
                {{ member.role }}
              </span>
              <span *ngIf="member.experience" class="tw-text-xs tw-text-gray-500">{{ member.experience }}</span>
            </div>
          </div>
        </div>

        <!-- Add Button -->
        <button 
          (click)="onAddMemberToBoard(member._id); $event.stopPropagation()"
          class="tw-bg-blue-600 tw-text-white tw-px-3 tw-py-1.5 tw-rounded-lg tw-text-xs tw-font-medium hover:tw-bg-blue-700 tw-transition-colors tw-duration-200"
        >
          Add
        </button>
      </div>

      <!-- Empty State for Available Members -->
      <div *ngIf="availableTeamMembers.length === 0" class="tw-text-center tw-py-8">
        <div class="tw-w-16 tw-h-16 tw-bg-gray-100 tw-rounded-full tw-flex tw-items-center tw-justify-center tw-mx-auto tw-mb-4">
          <svg class="tw-w-8 tw-h-8 tw-text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
          </svg>
        </div>
        <h4 class="tw-text-sm tw-font-medium tw-text-gray-900 tw-mb-2">No available members</h4>
        <p class="tw-text-xs tw-text-gray-500">All team members are already added to this board.</p>
      </div>
    </div>

    <!-- Action Buttons -->
    <div class="tw-flex tw-gap-3">
      <button 
        (click)="onCloseModal()"
        class="tw-flex-1 tw-px-4 tw-py-2 tw-border tw-border-gray-200 tw-text-gray-700 tw-rounded-lg tw-font-medium hover:tw-bg-gray-50 tw-transition-colors tw-duration-200"
      >
        Cancel
      </button>
    </div>
  </div>
</div>