<!-- Team Report Component Template -->
<div class="tw-container tw-mx-auto tw-p-6 tw-bg-gray-50 tw-min-h-screen">

  <!-- Filters Section -->
  <div class="tw-bg-white tw-rounded-lg tw-shadow-md tw-p-6 tw-mb-6">
    <div class="tw-flex tw-items-center tw-justify-between tw-mb-6">
      <h2 class="tw-text-2xl tw-font-bold tw-text-gray-800">Team Task Report</h2>
      
      <!-- Action Buttons - Moved to top right -->
      <div class="tw-flex tw-gap-3">
        <button 
          (click)="getReport()" 
          [disabled]="isLoading || !selectedMemberId"
          class="tw-bg-blue-600 tw-hover:bg-blue-700 tw-disabled:bg-gray-400 tw-text-white tw-px-6 tw-py-2.5 tw-rounded-lg tw-font-medium tw-transition-all tw-duration-200 tw-focus:outline-none tw-focus:ring-2 tw-focus:ring-blue-500 tw-focus:ring-offset-2 tw-shadow-md tw-hover:shadow-lg"
        >
          <span *ngIf="!isLoading">Generate Report</span>
          <span *ngIf="isLoading" class="tw-flex tw-items-center tw-gap-2">
            <span class="tw-animate-spin tw-rounded-full tw-h-4 tw-w-4 tw-border-b-2 tw-border-white"></span>
            Loading...
          </span>
        </button>

        <button 
          (click)="exportReport()" 
          [disabled]="!reportData"
          class="tw-bg-green-600 tw-hover:bg-green-700 tw-disabled:bg-gray-400 tw-text-white tw-px-6 tw-py-2.5 tw-rounded-lg tw-font-medium tw-transition-all tw-duration-200 tw-focus:outline-none tw-focus:ring-2 tw-focus:ring-green-500 tw-focus:ring-offset-2 tw-shadow-md tw-hover:shadow-lg"
        >
          Export Report
        </button>
      </div>
    </div>
    
    <div class="tw-grid tw-grid-cols-1 md:tw-grid-cols-2 lg:tw-grid-cols-4 tw-gap-6">
      <!-- Member Selection -->
      <div class="tw-space-y-2">
        <label class="tw-block tw-text-sm tw-font-semibold tw-text-gray-700">
          Select Member <span class="tw-text-red-500">*</span>
        </label>
        <select 
          [(ngModel)]="selectedMemberId" 
          class="tw-w-full tw-px-4 tw-py-3 tw-border-2 tw-border-gray-200 tw-rounded-lg tw-focus:outline-none tw-focus:ring-2 tw-focus:ring-blue-500 tw-focus:border-transparent tw-bg-white tw-transition-all tw-duration-200"
        >
          <option value="">Choose a member...</option>
          <option *ngFor="let member of members" [value]="member._id">
            {{ member.name }} ({{ member.role }})
          </option>
        </select>
      </div>

      <!-- Board Selection -->
      <div class="tw-space-y-2">
        <label class="tw-block tw-text-sm tw-font-semibold tw-text-gray-700">
          Select Board (Optional)
        </label>
        <select 
          [(ngModel)]="selectedBoardId" 
          class="tw-w-full tw-px-4 tw-py-3 tw-border-2 tw-border-gray-200 tw-rounded-lg tw-focus:outline-none tw-focus:ring-2 tw-focus:ring-blue-500 tw-focus:border-transparent tw-bg-white tw-transition-all tw-duration-200"
        >
          <option value="">All Boards</option>
          <option *ngFor="let board of boards" [value]="board._id">
            {{ board.name }}
          </option>
        </select>
      </div>

      <!-- Custom Date Selection -->
      <div class="tw-space-y-2">
        <label class="tw-block tw-text-sm tw-font-semibold tw-text-gray-700">
          Select Date (Optional)
        </label>
        <div class="tw-relative">
          <input 
            type="date" 
            [(ngModel)]="selectedDate"
            class="tw-w-full tw-px-4 tw-py-3 tw-border-2 tw-border-gray-200 tw-rounded-lg tw-focus:outline-none tw-focus:ring-2 tw-focus:ring-blue-500 tw-focus:border-transparent tw-bg-white tw-transition-all tw-duration-200 tw-text-gray-700"
          />
          <div class="tw-absolute tw-inset-y-0 tw-right-0 tw-flex tw-items-center tw-pr-3 tw-pointer-events-none">
            <svg class="tw-w-5 tw-h-5 tw-text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
            </svg>
          </div>
        </div>
      </div>

      <!-- Page Limit -->
      <div class="tw-space-y-2">
        <label class="tw-block tw-text-sm tw-font-semibold tw-text-gray-700">
          Records per page
        </label>
        <select 
          [(ngModel)]="pageLimit" 
          class="tw-w-full tw-px-4 tw-py-3 tw-border-2 tw-border-gray-200 tw-rounded-lg tw-focus:outline-none tw-focus:ring-2 tw-focus:ring-blue-500 tw-focus:border-transparent tw-bg-white tw-transition-all tw-duration-200"
        >
          <option [value]="10">10</option>
          <option [value]="25">25</option>
          <option [value]="50">50</option>
          <option [value]="100">100</option>
        </select>
      </div>
    </div>
  </div>

  <!-- Results Section -->
  <div *ngIf="searchClicked" class="tw-bg-white tw-rounded-lg tw-shadow-md tw-overflow-hidden">
    
    <!-- No Data Message -->
    <div *ngIf="!reportData" class="tw-p-12 tw-text-center">
      <div class="tw-text-gray-500 tw-text-xl tw-font-medium">
        No data found for the selected criteria.
      </div>
      <div class="tw-text-gray-400 tw-text-sm tw-mt-2">
        Try adjusting your filters and search again.
      </div>
    </div>

    <!-- Report Data -->
    <div *ngIf="reportData && getObjectKeys(reportData.tasks).length > 0">
      <!-- Board-wise Tasks -->
      <div *ngFor="let boardName of getObjectKeys(reportData.tasks)" class="tw-border-b tw-border-gray-200 tw-last:border-b-0">
        <!-- Board Header with Blue Gradient -->
        <div class="tw-bg-gradient-to-r tw-from-blue-50 tw-to-blue-100 tw-px-6 tw-py-5 tw-border-b tw-border-blue-200">
          <h4 class="tw-text-xl tw-font-bold tw-text-blue-800">
            {{ boardName }}
            <span class="tw-text-sm tw-font-medium tw-text-blue-600 tw-ml-3 tw-bg-white tw-px-3 tw-py-1 tw-rounded-full">
              {{ reportData.tasks[boardName].length }} tasks
            </span>
          </h4>
        </div>

        <!-- Tasks Table -->
        <div class="tw-overflow-x-auto">
          <table class="tw-w-full tw-text-sm">
            <thead class="tw-bg-gray-50">
              <tr>
                <th class="tw-px-6 tw-py-4 tw-text-left tw-font-semibold tw-text-gray-700 tw-border-b tw-border-gray-200">Task Title</th>
                <th class="tw-px-6 tw-py-4 tw-text-left tw-font-semibold tw-text-gray-700 tw-border-b tw-border-gray-200">Column</th>
                <th class="tw-px-6 tw-py-4 tw-text-left tw-font-semibold tw-text-gray-700 tw-border-b tw-border-gray-200">Status</th>
                <th class="tw-px-6 tw-py-4 tw-text-left tw-font-semibold tw-text-gray-700 tw-border-b tw-border-gray-200">Due Date</th>
                <th class="tw-px-6 tw-py-4 tw-text-center tw-font-semibold tw-text-gray-700 tw-border-b tw-border-gray-200">Completed</th>
                <th class="tw-px-6 tw-py-4 tw-text-center tw-font-semibold tw-text-gray-700 tw-border-b tw-border-gray-200">Comments</th>
                <th class="tw-px-6 tw-py-4 tw-text-center tw-font-semibold tw-text-gray-700 tw-border-b tw-border-gray-200">Attachments</th>
                <th class="tw-px-6 tw-py-4 tw-text-left tw-font-semibold tw-text-gray-700 tw-border-b tw-border-gray-200">Assigned To</th>
              </tr>
            </thead>
            <tbody>
              <tr 
                *ngFor="let task of reportData.tasks[boardName]; trackBy: trackByTaskId; let i = index" 
                class="tw-border-b tw-border-gray-100 tw-hover:bg-blue-25 tw-transition-colors tw-duration-150"
              >
                <td class="tw-px-6 tw-py-4">
                  <div class="tw-font-semibold tw-text-gray-900 tw-text-base">{{ task.taskTitle }}</div>
                </td>
                <td class="tw-px-6 tw-py-4">
                  <span class="tw-inline-flex tw-items-center tw-px-3 tw-py-1.5 tw-rounded-full tw-text-xs tw-font-semibold tw-bg-blue-100 tw-text-blue-800">
                    {{ task.columnName }}
                  </span>
                </td>
                <td class="tw-px-6 tw-py-4">
                  <span class="tw-inline-flex tw-items-center tw-px-3 tw-py-1.5 tw-rounded-full tw-text-xs tw-font-semibold"
                        [ngClass]="{
                          'tw-bg-green-100 tw-text-green-800': task.status === 'completed',
                          'tw-bg-yellow-100 tw-text-yellow-800': task.status === 'in-progress',
                          'tw-bg-red-100 tw-text-red-800': task.status === 'pending',
                          'tw-bg-gray-100 tw-text-gray-800': task.status !== 'completed' && task.status !== 'in-progress' && task.status !== 'pending'
                        }">
                    {{ task.status }}
                  </span>
                </td>
                <td class="tw-px-6 tw-py-4 tw-text-gray-600 tw-font-medium">
                  {{ task.dueDate || 'No due date' }}
                </td>
                <td class="tw-px-6 tw-py-4 tw-text-center">
                  <span *ngIf="task.isCompleted === 'true'" class="tw-inline-flex tw-items-center tw-px-3 tw-py-1 tw-rounded-full tw-text-xs tw-font-semibold tw-bg-green-100 tw-text-green-800">
                    Yes
                  </span>
                  <span *ngIf="task.isCompleted !== 'true'" class="tw-inline-flex tw-items-center tw-px-3 tw-py-1 tw-rounded-full tw-text-xs tw-font-semibold tw-bg-red-100 tw-text-red-800">
                    No
                  </span>
                </td>
                <td class="tw-px-6 tw-py-4 tw-text-center">
                  <span class="tw-inline-flex tw-items-center tw-justify-center tw-w-8 tw-h-8 tw-bg-blue-100 tw-text-blue-800 tw-text-sm tw-font-bold tw-rounded-full">
                    {{ task.commentCount || 0 }}
                  </span>
                </td>
                <td class="tw-px-6 tw-py-4 tw-text-center">
                  <span class="tw-inline-flex tw-items-center tw-justify-center tw-w-8 tw-h-8 tw-bg-gray-100 tw-text-gray-800 tw-text-sm tw-font-bold tw-rounded-full">
                    {{ task.attachmentCount || 0 }}
                  </span>
                </td>
                <td class="tw-px-6 tw-py-4 tw-text-gray-600 tw-font-medium">
                  {{ task.assignedTo || 'Unassigned' }}
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Enhanced Pagination -->
    <div *ngIf="reportData && reportData.pagination" class="tw-bg-gradient-to-r tw-from-gray-50 tw-to-gray-100 tw-px-6 tw-py-5 tw-border-t tw-border-gray-200">
      <div class="tw-flex tw-items-center tw-justify-center tw-gap-4">
        <!-- Previous Button -->
        <button 
          (click)="changePage(reportData.pagination.prevPage)"
          [disabled]="!reportData.pagination.hasPrevPage"
          class="tw-px-6 tw-py-2.5 tw-text-sm tw-font-medium tw-bg-white tw-border-2 tw-border-gray-200 tw-rounded-lg tw-hover:bg-gray-50 tw-hover:border-blue-300 tw-disabled:opacity-50 tw-disabled:cursor-not-allowed tw-transition-all tw-duration-200 tw-shadow-sm"
        >
          Previous
        </button>

        <!-- Current Page Display -->
        <span class="tw-px-6 tw-py-2.5 tw-text-sm tw-font-bold tw-text-gray-700 tw-bg-white tw-rounded-lg tw-border-2 tw-border-blue-200">
          Page {{ reportData.pagination.page }} of {{ reportData.pagination.totalPages }}
        </span>

        <!-- Next Button -->
        <button 
          (click)="changePage(reportData.pagination.nextPage)"
          [disabled]="!reportData.pagination.hasNextPage"
          class="tw-px-6 tw-py-2.5 tw-text-sm tw-font-medium tw-bg-white tw-border-2 tw-border-gray-200 tw-rounded-lg tw-hover:bg-gray-50 tw-hover:border-blue-300 tw-disabled:opacity-50 tw-disabled:cursor-not-allowed tw-transition-all tw-duration-200 tw-shadow-sm"
        >
          Next
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Enhanced Page Loader -->
<div
  class="tw-fixed tw-top-0 tw-left-0 tw-right-0 tw-bottom-0 tw-flex tw-items-center tw-justify-center tw-bg-[#0000004d] tw-z-30"
  *ngIf="isLoading"
>
  <div class="tw-flex tw-items-center tw-gap-6 tw-bg-white tw-px-10 tw-py-6 tw-rounded-lg tw-shadow-xl">
    <span class="tw-animate-spin tw-rounded-full tw-h-6 tw-w-6 tw-border-b-2 tw-border-blue-600"></span>
    <span class="tw-text-gray-700 tw-font-semibold tw-text-lg">Generating report...</span>
  </div>
</div>